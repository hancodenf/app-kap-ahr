import{r as n,u as Fe,j as e,H as Te,L as We,b as P}from"./app-ClcqIkg_.js";import{A as Ie}from"./AuthenticatedLayout-Brdiehg9.js";import"./ApplicationLogo-Pq6XhuR0.js";function Ee({auth:ze,project:C,workingSteps:K,myRole:J}){const[_,Y]=n.useState("my-tasks"),[H,ie]=n.useState([]),[oe,Q]=n.useState(!1),[R,A]=n.useState(null),[de,D]=n.useState(!1),[v,Z]=n.useState("approve"),[B,L]=n.useState(""),[V,ee]=n.useState(!1),[se,ce]=n.useState([]),[l,f]=n.useState(null),[$,b]=n.useState(!1),[me,h]=n.useState(!1),[te,E]=n.useState([]),[q,y]=n.useState("upload"),[xe,S]=n.useState(!1),[F,T]=n.useState(""),[p,x]=n.useState([{id:0,label:"",file:null}]),[j,u]=n.useState([{id:0,name:"",description:""}]),[W,N]=n.useState(1),[I,w]=n.useState(1),ue=J.toLowerCase(),U=["team leader","manager","supervisor","partner"].includes(ue);n.useEffect(()=>{_==="approval-requests"&&U&&O(),b(!1),f(null),h(!1),y("upload"),x([{id:0,label:"",file:null}]),u([{id:0,name:"",description:""}]),N(1),w(1),D(!1),A(null),L(""),S(!1),T(""),z()},[_]);const O=async()=>{Q(!0);try{const r=await(await fetch(route("company.projects.approval-requests",C.id))).json();ie(r.tasks||[])}catch(s){console.error("Error fetching approval requests:",s)}finally{Q(!1)}},he=s=>{A(s),Z("approve"),L(""),D(!0)},pe=s=>{A(s),Z("reject"),L(""),D(!0)},ge=async()=>{if(R){if(v==="reject"&&!B.trim()){alert("Please provide a reason for rejection.");return}ee(!0);try{const s=v==="approve"?route("company.tasks.approve",R.id):route("company.tasks.reject",R.id),t=await(await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({comment:B})})).json();t.success?(D(!1),A(null),L(""),O(),alert(t.message)):alert(t.error||"An error occurred")}catch(s){console.error("Error processing approval:",s),alert("An error occurred")}finally{ee(!1)}}};n.useEffect(()=>($?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[$]);const{data:k,setData:d,post:fe,put:Pe,processing:X,errors:M,reset:z}=Fe({notes:"",files:[],file_labels:[],upload_mode:"upload",client_documents:[],existing_document_labels:[],_method:"PUT"}),be=s=>{ce(r=>r.includes(s)?r.filter(t=>t!==s):[...r,s])},je=(s,r)=>{if(!r.can_access||!s.is_assigned_to_me)return;f(s);const t=s.status==="Draft"||s.status==="Submitted"||s.status==="Submitted to Client",i=!s.assignments||s.assignments.length===0;h(t||i),s.assignments&&s.assignments.length>0?E([s.assignments[0].id]):E([]),y("upload");let a=[{id:0,label:"",file:null}],o=[{id:0,name:"",description:""}],c=1,ne=1;const g=s.assignments&&s.assignments.length>0?s.assignments[0]:null;g&&(g.documents&&g.documents.length>0&&(a=g.documents.map((m,G)=>({id:G,label:m.name,file:null,existingDocId:m.id,existingFilePath:m.file})),c=g.documents.length),g.client_documents&&g.client_documents.length>0&&(o=g.client_documents.map((m,G)=>({id:G,name:m.name,description:m.description||""})),ne=g.client_documents.length)),x(a),u(o),N(c),w(ne),d({notes:s.latest_assignment?.notes||"",files:[],client_documents:o.filter(m=>m.name.trim()!=="").map(m=>({name:m.name,description:m.description})),upload_mode:"upload"}),b(!0)},ve=s=>{E(r=>r.includes(s)?r.filter(t=>t!==s):[...r,s])},ye=(s,r)=>{const t=p.map(a=>a.id===s?{...a,label:r}:a);x(t);const i=t.filter(a=>a.file!==null).map(a=>a.label||"");d("file_labels",i)},re=(s,r)=>{const t=p.map(o=>o.id===s?{...o,file:r}:o);x(t);const i=t.filter(o=>o.file!==null).map(o=>o.file),a=t.filter(o=>o.file!==null).map(o=>o.label||"");d("files",i),d("file_labels",a)},Ne=(s,r)=>{r.preventDefault(),r.stopPropagation();const t=r.dataTransfer.files?.[0];t&&re(s,t)},we=(s,r)=>{const t=r.target.files?.[0];t&&re(s,t)},ke=()=>{l&&!l.multiple_files&&p.length>=1||(x([...p,{id:W,label:"",file:null}]),N(W+1))},Ce=s=>{if(p.length===1)x([{id:W,label:"",file:null}]),N(W+1),d("files",[]),d("file_labels",[]);else{const r=p.filter(a=>a.id!==s);x(r);const t=r.filter(a=>a.file!==null).map(a=>a.file),i=r.filter(a=>a.file!==null).map(a=>a.label||"");d("files",t),d("file_labels",i)}},_e=(s,r)=>{const t=j.map(a=>a.id===s?{...a,name:r}:a);u(t);const i=t.filter(a=>a.name.trim()!=="").map(a=>({name:a.name,description:a.description}));d("client_documents",i)},Le=(s,r)=>{const t=j.map(a=>a.id===s?{...a,description:r}:a);u(t);const i=t.filter(a=>a.name.trim()!=="").map(a=>({name:a.name,description:a.description}));d("client_documents",i)},Se=()=>{l&&!l.multiple_files&&j.length>=1||(u([...j,{id:I,name:"",description:""}]),w(I+1))},Me=s=>{if(j.length===1)u([{id:I,name:"",description:""}]),w(I+1),d("client_documents",[]);else{const r=j.filter(i=>i.id!==s);u(r);const t=r.filter(i=>i.name.trim()!=="").map(i=>({name:i.name,description:i.description}));d("client_documents",t)}},Re=s=>{if(s.preventDefault(),!l)return;const r=k.files&&k.files.length>0,t=k.client_documents&&k.client_documents.length>0,i=p.some(c=>c.existingFilePath),a=j.some(c=>c.name.trim()!=="");if(!r&&!t&&!i&&!a){alert("Please upload at least one file or request at least one document from client.");return}const o=p.filter(c=>c.existingDocId&&!c.file).map(c=>({doc_id:c.existingDocId,label:c.label}));k.existing_document_labels=o,k._method="PUT",fe(route("company.tasks.update-status",l.id),{preserveScroll:!0,forceFormData:!0,onSuccess:()=>{b(!1),f(null),h(!1),y("upload"),x([{id:0,label:"",file:null}]),u([{id:0,name:"",description:""}]),N(1),w(1),z(),P.reload({only:["workingSteps"]})}})},Ae=async()=>{if(l&&confirm("Submit this task for review? You will not be able to edit it after submission."))try{const s=await fetch(route("company.tasks.submit-for-review",l.id),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}}),r=await s.json();s.ok?(alert("Task submitted for review successfully!"),b(!1),f(null),h(!1),P.reload({only:["workingSteps"]})):alert(r.error||"Failed to submit task for review")}catch(s){console.error("Error submitting for review:",s),alert("An error occurred while submitting for review")}},le=async()=>{l&&confirm("Accept all client documents and mark task as completed?")&&P.post(route("company.tasks.accept-client-documents",l.id),{},{preserveScroll:!0,onSuccess:()=>{alert("Client documents accepted! Task marked as completed."),b(!1),f(null),h(!1)},onError:s=>{console.error("Server errors:",s);const r=s.error||Object.values(s).join(", ")||"Failed to accept client documents";alert(`Error: ${r}`)}})},De=async()=>{if(!l||!F.trim()){alert("Please provide a reason for requesting re-upload");return}P.post(route("company.tasks.request-reupload",l.id),{comment:F},{preserveScroll:!0,onSuccess:()=>{alert("Re-upload request sent to client!"),S(!1),T(""),b(!1),f(null),h(!1)},onError:s=>{console.error("Server errors:",s);const r=s.error||Object.values(s).join(", ")||"Failed to request re-upload";alert(`Error: ${r}`)}})},Be=s=>{switch(s){case"completed":return"bg-green-100 text-green-800";case"in_progress":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},ae=s=>s.includes("Approved")?"bg-green-100 text-green-800 border border-green-200":s.includes("Under Review")?"bg-blue-100 text-blue-800 border border-blue-200":s.includes("Returned")?"bg-red-100 text-red-800 border border-red-200":s==="Submitted to Client"||s==="Client Reply"?"bg-purple-100 text-purple-800 border border-purple-200":s==="Submitted"?"bg-yellow-100 text-yellow-800 border border-yellow-200":"bg-gray-100 text-gray-800 border border-gray-200",qe=s=>{switch(s){case"completed":return e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})});case"in_progress":return e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})});default:return e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})})}};return e.jsxs(Ie,{header:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(We,{href:route("company.projects.index"),className:"text-sm text-gray-500 hover:text-gray-700 mb-1 inline-block",children:"â† Back to Projects"}),e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:C.name}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Client: ",C.client_name," â€¢ Role: ",J]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${C.status==="open"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:C.status})]}),children:[e.jsx(Te,{title:C.name}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[U&&e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"border-b border-gray-200 bg-white rounded-t-lg shadow-sm",children:e.jsxs("nav",{className:"-mb-px flex","aria-label":"Tabs",children:[e.jsx("button",{onClick:()=>Y("my-tasks"),className:`${_==="my-tasks"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} flex-1 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:"ðŸ“‹ My Tasks"}),e.jsx("button",{onClick:()=>Y("approval-requests"),className:`${_==="approval-requests"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} flex-1 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:"âœ… Approval Requests"})]})})}),e.jsx("div",{className:"overflow-hidden bg-white shadow-sm sm:rounded-lg",children:e.jsxs("div",{className:"p-6",children:[_==="my-tasks"&&e.jsx(e.Fragment,{children:K.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No working steps in this project yet."})}):e.jsx("div",{className:"space-y-4",children:K.map((s,r)=>e.jsxs("div",{className:`border rounded-lg ${s.is_locked&&!s.can_access?"border-gray-300 bg-gray-50":"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:`p-4 flex items-center justify-between cursor-pointer ${s.is_locked&&!s.can_access?"opacity-60":""}`,onClick:()=>be(s.id),children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("span",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary-100 text-primary-700 font-semibold text-sm",children:r+1}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[s.name,s.is_locked&&!s.can_access&&e.jsx("svg",{className:"w-5 h-5 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),!s.is_locked&&e.jsx("svg",{className:"w-5 h-5 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M10 2a5 5 0 00-5 5v2a2 2 0 00-2 2v5a2 2 0 002 2h10a2 2 0 002-2v-5a2 2 0 00-2-2H7V7a3 3 0 015.905-.75 1 1 0 001.937-.5A5.002 5.002 0 0010 2z"})})]}),s.is_locked&&!s.can_access&&s.required_progress&&e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"ðŸ”’ Locked - Complete required tasks in previous step"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-red-500 h-2 rounded-full transition-all",style:{width:`${s.required_progress.percentage}%`}})}),e.jsxs("span",{className:"text-xs text-gray-600 min-w-[60px]",children:[s.required_progress.completed,"/",s.required_progress.total," tasks"]})]})]})]})]}),e.jsx("svg",{className:`w-5 h-5 text-gray-500 transition-transform ${se.includes(s.id)?"transform rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),se.includes(s.id)&&e.jsx("div",{className:"border-t border-gray-200 p-4 bg-gray-50",children:s.tasks.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No tasks in this step."}):e.jsx("div",{className:"space-y-2",children:s.tasks.map(t=>e.jsx("div",{onClick:()=>je(t,s),className:`p-4 rounded-lg border ${t.is_assigned_to_me&&s.can_access?"bg-white border-gray-200 hover:border-primary-300 hover:shadow-sm cursor-pointer":"bg-gray-100 border-gray-200 cursor-not-allowed"} transition-all`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[qe(t.completion_status),e.jsx("h4",{className:"font-medium text-gray-900",children:t.name}),t.is_required&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800",children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Required"]}),!t.is_assigned_to_me&&e.jsx("span",{className:"text-xs text-gray-500 italic",children:"(Not assigned to you)"})]}),t.latest_assignment?.comment&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["ðŸ’¬ ",t.latest_assignment.comment]}),t.latest_assignment?.time&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["â±ï¸ ",new Date(t.latest_assignment.time).toLocaleDateString("id-ID")]})]}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${Be(t.completion_status)}`,children:t.completion_status.replace("_"," ")})]})},t.id))})})]},s.id))})}),U&&_==="approval-requests"&&e.jsx(e.Fragment,{children:oe?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Loading approval requests..."})]}):H.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"text-gray-500 mt-4",children:"No tasks awaiting your approval"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Tasks will appear here when team members submit work for review"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Tasks Awaiting Approval (",H.length,")"]}),e.jsxs("button",{onClick:O,className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:[e.jsx("svg",{className:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})]}),H.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-5 bg-white hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:s.name}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${ae(s.status)}`,children:s.status})]}),s.working_step&&e.jsxs("p",{className:"text-sm text-gray-600",children:["ðŸ“ Step: ",s.working_step.name]}),s.latest_assignment?.created_at&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["ðŸ• ",new Date(s.latest_assignment.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})}),s.latest_assignment&&e.jsxs("div",{className:"mt-4 space-y-3",children:[s.latest_assignment.notes&&e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"ðŸ“ Notes:"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.latest_assignment.notes})]}),s.latest_assignment.documents.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-medium text-gray-700 mb-2",children:["ðŸ“ Uploaded Documents (",s.latest_assignment.documents.length,"):"]}),e.jsx("div",{className:"space-y-2",children:s.latest_assignment.documents.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-blue-50 border border-blue-200 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:r.name})]}),e.jsxs("a",{href:`/storage/${r.file}`,download:!0,className:"inline-flex items-center px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-800",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]})]},r.id))})]}),s.latest_assignment.client_documents.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-medium text-gray-700 mb-2",children:["ðŸ“‹ Requested Documents (",s.latest_assignment.client_documents.length,"):"]}),e.jsx("div",{className:"space-y-2",children:s.latest_assignment.client_documents.map(r=>e.jsxs("div",{className:"p-2 bg-purple-50 border border-purple-200 rounded",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:r.name}),r.description&&e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:r.description})]},r.id))})]})]}),e.jsxs("div",{className:"mt-4 flex gap-3",children:[e.jsxs("button",{onClick:()=>he(s),className:"flex-1 inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Approve"]}),e.jsxs("button",{onClick:()=>pe(s),className:"flex-1 inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Reject"]})]})]},s.id))]})})]})})]})}),de&&R&&e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:v==="approve"?"âœ… Approve Task":"âŒ Reject Task"}),e.jsxs("p",{className:"text-sm text-gray-700 mb-4",children:["Task: ",e.jsx("span",{className:"font-semibold",children:R.name})]}),v==="approve"?e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Are you sure you want to approve this task? It will move to the next stage in the approval workflow."}):e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for Rejection *"}),e.jsx("textarea",{value:B,onChange:s=>L(s.target.value),rows:4,placeholder:"Please explain why you're rejecting this task...",className:"w-full border-gray-300 rounded-md shadow-sm focus:border-red-500 focus:ring-red-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{D(!1),A(null),L("")},disabled:V,className:"flex-1 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:ge,disabled:V||v==="reject"&&!B.trim(),className:`flex-1 px-4 py-2 text-sm font-medium text-white rounded-md disabled:opacity-50 ${v==="approve"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,children:V?"Processing...":v==="approve"?"Approve":"Reject"})]})]})}),"            ",$&&l&&e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full my-8 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between sticky top-0 bg-white pt-6 pb-4 border-b border-gray-200 px-6 z-10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Update Task: ",l.name]}),e.jsx("button",{type:"button",onClick:()=>{b(!1),f(null),h(!1),y("upload"),x([{id:0,label:"",file:null}]),u([{id:0,name:"",description:""}]),N(1),w(1),z()},className:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 rounded-lg p-1.5 transition-colors","aria-label":"Close modal",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-6 pb-6",children:me?e.jsxs("form",{onSubmit:Re,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Task Status:"}),e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${ae(l.status)}`,children:l.status})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Notes",e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(Your submission notes)"})]}),e.jsx("textarea",{value:k.notes,onChange:s=>d("notes",s.target.value),rows:3,placeholder:"Add your notes here...",className:"w-full border-gray-300 rounded-md shadow-sm focus:border-primary-500 focus:ring-primary-500"}),M.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:M.notes})]}),l.assignments&&l.assignments.length>0&&(l.assignments.length>1||l.status!=="Draft"&&l.status!=="Submitted"&&l.status!=="Submitted to Client")&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:["Submission History (",l.assignments.length," submission",l.assignments.length>1?"s":"",")"]}),e.jsx("div",{className:"space-y-4",children:l.assignments.map((s,r)=>e.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["Submission #",l.assignments.length-r,r===0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-blue-100 text-blue-800 rounded-full",children:"Latest"}),s.is_approved&&e.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-green-100 text-green-800 rounded-full",children:"Approved"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(s.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})}),s.notes&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700",children:"ðŸ“ Notes:"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.notes})]}),s.comment&&e.jsxs("div",{className:"mb-3 p-2 bg-red-50 border-l-4 border-red-400 rounded",children:[e.jsx("p",{className:"text-xs font-medium text-red-800",children:"âŒ Rejection Reason:"}),e.jsx("p",{className:"text-sm text-red-900 mt-1",children:s.comment})]}),s.client_comment&&e.jsxs("div",{className:"mb-3 p-2 bg-yellow-50 border-l-4 border-yellow-400 rounded",children:[e.jsx("p",{className:"text-xs font-medium text-yellow-800",children:"ðŸ’¬ Client Reply:"}),e.jsx("p",{className:"text-sm text-yellow-900 mt-1",children:s.client_comment})]}),s.documents&&s.documents.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-700",children:["ðŸ“ Uploaded Documents (",s.documents.length,"):"]}),s.documents.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white border border-gray-200 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"text-sm text-gray-900",children:t.name})]}),e.jsxs("a",{href:`/storage/${t.file}`,download:!0,className:"inline-flex items-center px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-800",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]})]},t.id))]}),s.client_documents&&s.client_documents.length>0&&e.jsxs("div",{className:"space-y-2 mt-3",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-700",children:["ðŸ“‹ Requested Documents (",s.client_documents.length,"):"]}),s.client_documents.map(t=>e.jsx("div",{className:"p-2 bg-purple-50 border border-purple-200 rounded",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-2 flex-1",children:[e.jsx("svg",{className:"w-5 h-5 text-purple-600 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.name}),t.description&&e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:t.description}),t.file&&t.uploaded_at&&e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["âœ… Uploaded by client on ",new Date(t.uploaded_at).toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),!t.file&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"â³ Waiting for client upload"})]})]}),t.file&&e.jsxs("a",{href:`/storage/${t.file}`,download:!0,className:"inline-flex items-center px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-800 ml-2",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]})]})},t.id))]})]},s.id))})]}),l.status==="Client Reply"&&l.is_assigned_to_me&&e.jsxs("div",{className:"mb-6 p-4 bg-yellow-50 border-2 border-yellow-300 rounded-lg",children:[e.jsxs("div",{className:"flex items-start space-x-3 mb-4",children:[e.jsx("svg",{className:"w-6 h-6 text-yellow-600 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-yellow-900 mb-1",children:"Client has uploaded documents"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"Please review the documents uploaded by the client. You can accept them to complete the task or request re-upload if they need corrections."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"button",onClick:le,className:"flex-1 inline-flex items-center justify-center px-4 py-2.5 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Accept & Mark Complete"]}),e.jsxs("button",{type:"button",onClick:()=>S(!0),className:"flex-1 inline-flex items-center justify-center px-4 py-2.5 bg-orange-600 hover:bg-orange-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Request Re-upload"]})]})]}),l.client_interact&&e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[e.jsx("button",{type:"button",onClick:()=>y("upload"),className:`${q==="upload"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:"ðŸ“ Upload Files"}),e.jsx("button",{type:"button",onClick:()=>y("request"),className:`${q==="request"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:"ðŸ“‹ Request from Client"})]})})}),(!l.client_interact||q==="upload")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Upload Files",l.multiple_files?e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(Multiple files allowed)"}):e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(Single file only)"})]}),l.multiple_files&&e.jsxs("button",{type:"button",onClick:ke,className:"inline-flex items-center px-3 py-1 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add File"]})]}),e.jsx("div",{className:"space-y-4",children:p.map((s,r)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"File Label / Name"}),e.jsx("input",{type:"text",value:s.label,onChange:t=>ye(s.id,t.target.value),placeholder:"e.g., Laporan Keuangan, KTP, etc.",className:"block w-full text-sm border-gray-300 rounded-md shadow-sm focus:border-primary-500 focus:ring-primary-500"})]}),e.jsx("button",{type:"button",onClick:()=>Ce(s.id),className:"mt-6 p-1.5 text-red-600 hover:text-red-700 hover:bg-red-100 rounded-md transition-colors",title:"Remove file input",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),s.existingFilePath&&!s.file&&e.jsx("div",{className:"mt-3 p-2 bg-blue-50 border border-blue-200 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z",clipRule:"evenodd"})}),e.jsxs("span",{className:"text-xs text-blue-800",children:["ðŸ“Ž Current file: ",s.label]})]}),e.jsxs("a",{href:`/storage/${s.existingFilePath}`,download:!0,className:"inline-flex items-center px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-800 hover:bg-blue-100 rounded",children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]})]})}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"File Upload"}),e.jsxs("div",{onDrop:t=>Ne(s.id,t),onDragOver:t=>t.preventDefault(),onDragEnter:t=>t.preventDefault(),className:"relative border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary-400 hover:bg-white transition-colors cursor-pointer",children:[s.file?e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-green-600",children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.file.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(s.file.size/1024).toFixed(2)," KB"]})]})]}):e.jsxs("div",{children:[e.jsx("svg",{className:"mx-auto h-8 w-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:[e.jsx("span",{className:"font-semibold text-primary-600",children:"Click to upload"})," or drag and drop"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"PDF, DOC, DOCX, XLS, XLSX, JPG, PNG (Max. 10MB)"})]}),e.jsx("input",{type:"file",onChange:t=>we(s.id,t),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png"})]})]})]},s.id))}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Allowed: PDF, DOC, DOCX, XLS, XLSX, JPG, JPEG, PNG (Max. 10MB per file)"}),M.files&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:M.files})]}),l.client_interact&&q==="request"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Request Documents from Client",l.multiple_files?e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(Multiple documents allowed)"}):e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(Single document only)"})]}),l.multiple_files&&e.jsxs("button",{type:"button",onClick:Se,className:"inline-flex items-center px-3 py-1 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Document"]})]}),e.jsx("div",{className:"space-y-4",children:j.map((s,r)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Document Name *"}),e.jsx("input",{type:"text",value:s.name,onChange:t=>_e(s.id,t.target.value),placeholder:"e.g., Financial Report 2024",className:"block w-full text-sm border-gray-300 rounded-md shadow-sm focus:border-primary-500 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:s.description,onChange:t=>Le(s.id,t.target.value),rows:2,placeholder:"Add details about what document is needed...",className:"block w-full text-sm border-gray-300 rounded-md shadow-sm focus:border-primary-500 focus:ring-primary-500"})]})]}),e.jsx("button",{type:"button",onClick:()=>Me(s.id),className:"mt-6 p-1.5 text-red-600 hover:text-red-700 hover:bg-red-100 rounded-md transition-colors",title:"Remove document request",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})},s.id))}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Specify which documents you need from the client"}),M.client_documents&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:M.client_documents})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>{b(!1),f(null),h(!1),y("upload"),x([{id:0,label:"",file:null}]),u([{id:0,name:"",description:""}]),N(1),w(1),z()},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:X,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",children:X?"Saving...":"Save Changes"}),l&&(l.status==="Draft"||l.status==="Submitted"||l.status.includes("Returned for Revision"))&&l.assignments&&l.assignments.length>0&&e.jsx("button",{type:"button",onClick:Ae,disabled:X,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 disabled:opacity-50",children:"ðŸ“¤ Submit for Review"})]})]}):e.jsx("div",{className:"space-y-4",children:l.assignments&&l.assignments.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:["Submission History (",l.assignments.length," submission",l.assignments.length>1?"s":"",")"]}),e.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto",children:l.assignments.map((s,r)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden bg-white",children:[e.jsx("div",{className:"p-4 bg-gray-50 hover:bg-gray-100 cursor-pointer transition-colors",onClick:()=>ve(s.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["Submission #",l.assignments.length-r]}),r===0&&e.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-800 rounded-full",children:"Latest"}),s.is_approved&&e.jsx("span",{className:"px-2 py-0.5 text-xs bg-green-100 text-green-800 rounded-full",children:"âœ“ Approved"}),s.comment&&!s.is_approved&&e.jsx("span",{className:"px-2 py-0.5 text-xs bg-red-100 text-red-800 rounded-full",children:"âœ— Rejected"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(s.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsx("svg",{className:`w-5 h-5 text-gray-500 transition-transform ${te.includes(s.id)?"transform rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),te.includes(s.id)&&e.jsxs("div",{className:"p-4 border-t border-gray-200 bg-white space-y-3",children:[s.notes&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-700",children:"ðŸ“ Notes:"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.notes})]}),s.comment&&e.jsxs("div",{className:"p-2 bg-red-50 border-l-4 border-red-400 rounded",children:[e.jsx("p",{className:"text-xs font-medium text-red-800",children:"âŒ Rejection Reason:"}),e.jsx("p",{className:"text-sm text-red-900 mt-1",children:s.comment})]}),s.client_comment&&e.jsxs("div",{className:"p-2 bg-yellow-50 border-l-4 border-yellow-400 rounded",children:[e.jsx("p",{className:"text-xs font-medium text-yellow-800",children:"ðŸ’¬ Client Reply:"}),e.jsx("p",{className:"text-sm text-yellow-900 mt-1",children:s.client_comment})]}),s.documents&&s.documents.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-700",children:["ðŸ“ Uploaded Documents (",s.documents.length,"):"]}),s.documents.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 border border-gray-200 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"text-sm text-gray-900",children:t.name})]}),e.jsxs("a",{href:`/storage/${t.file}`,download:!0,className:"inline-flex items-center px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-800",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]})]},t.id))]}),s.client_documents&&s.client_documents.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-700",children:["ðŸ“‹ Requested Documents (",s.client_documents.length,"):"]}),s.client_documents.map(t=>e.jsx("div",{className:"p-2 bg-purple-50 border border-purple-200 rounded",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-2 flex-1",children:[e.jsx("svg",{className:"w-5 h-5 text-purple-600 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.name}),t.description&&e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:t.description}),t.file&&t.uploaded_at&&e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["âœ… Uploaded by client on ",new Date(t.uploaded_at).toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),!t.file&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"â³ Waiting for client upload"})]})]}),t.file&&e.jsxs("a",{href:`/storage/${t.file}`,download:!0,className:"inline-flex items-center px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-800 ml-2",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]})]})},t.id))]})]})]},s.id))}),l.status==="Client Reply"&&l.is_assigned_to_me&&e.jsxs("div",{className:"mt-6 p-4 bg-yellow-50 border-2 border-yellow-300 rounded-lg",children:[e.jsxs("div",{className:"flex items-start space-x-3 mb-4",children:[e.jsx("svg",{className:"w-6 h-6 text-yellow-600 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-yellow-900 mb-1",children:"Client has uploaded documents"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"Please review the documents uploaded by the client. You can accept them to complete the task or request re-upload if they need corrections."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"button",onClick:le,className:"flex-1 inline-flex items-center justify-center px-4 py-2.5 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Accept & Mark Complete"]}),e.jsxs("button",{type:"button",onClick:()=>S(!0),className:"flex-1 inline-flex items-center justify-center px-4 py-2.5 bg-orange-600 hover:bg-orange-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Request Re-upload"]})]})]}),l.assignments.length>0&&l.assignments[0].comment&&!l.assignments[0].is_approved&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsxs("button",{type:"button",onClick:()=>h(!0),className:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-primary-600 rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add New Submission"]})})]})})})]})}),xe&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:()=>S(!1)}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"â€‹"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6",children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-orange-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{className:"h-6 w-6 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left flex-1",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",id:"modal-title",children:"Request Re-upload from Client"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"The previous submission will be kept in history. Please provide a reason for requesting re-upload:"}),e.jsx("textarea",{value:F,onChange:s=>T(s.target.value),rows:4,placeholder:"Example: The documents need to be in PDF format, not images...",className:"w-full border-gray-300 rounded-md shadow-sm focus:border-orange-500 focus:ring-orange-500",required:!0})]})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"button",onClick:De,disabled:!F.trim(),className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-orange-600 text-base font-medium text-white hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Send Request"}),e.jsx("button",{type:"button",onClick:()=>{S(!1),T("")},className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:w-auto sm:text-sm",children:"Cancel"})]})]})]})})]})}export{Ee as default};
